.. sectionauthor:: Михаил Гусев <mikhail.gusev@nextgis.ru>

.. _ngfb_workflow:

Процесс работы с программой
===========================

Создание новой локальной формы
------------------------------

1. Запустите программу. Если программа уже запущена, выберите: Файл -> Новый;
2. Задайте необходимую геометрию данных которые будут собираться. Выберите: Правка -> Свойства формы и в открывшемся диалоге укажите тип геометрии, затем нажмите ОК;
3. Добавьте на форму необходимые элементы, расположив их в нужном порядке. Если необходимо, выполните дополнительные шаги (можно пропустить):

    - переименуйте псевдонимы полей и задайте им необходимые типы в меню "Данные";
    - настройте свойства элементов в меню "Свойства";

4. Сохраните проект в файл. Выберите Файл -> Сохранить и укажите путь до файла. Получившийся файл с расширением .ngfp готов для закачивания на мобильное устройство и для осуществления сбора данных.

.. note::
    Для сбора данных на мобильном устройстве следуйте инструкции NextGIS Mobile. После окончания сбора вы можете получить собранные данные в виде отдельного файла. В NextGIS Mobile выберите: Основное меню -> найдите слой в который собирались данные -> кнопка действий со слоем (троеточие) -> Поделиться -> во всплыващем диалоге выберите способ получения итогового файла (ZIP-архив с данными в формате GeoJSON).

Изменение локальной формы
-------------------------

1. Запустите программу. Выберите: Файл -> Открыть. Укажите путь до файла с расширением .ngfp.
2. Внесите необходимые изменения в форму;
3. Сохраните проект в файл. Выберите Файл -> Сохранить. Получившийся файл с расширением .ngfp может быть загружен на мобильное устройство как *новый* слой.

Создание новой формы в NextGIS Web
----------------------------------

1. Запустите программу. Создайте новый проект или откройте существующий из файла .ngfp;
2. Установите режим автоматического создания полей при создании элементов. Кнопка **"Связывать элементы с полями"** должна быть нажата.
3. Добавьте на форму необходимые элементы, расположив их в нужном порядке. Если необходимо, выполните дополнительные шаги (можно пропустить):

    - переименуйте псевдонимы полей и задайте им необходимые типы в меню "Данные";
    - настройте свойства элементов в меню "Свойства".

4. Для отправки формы в NextGIS Web выберите: Правка -> Отправить в NextGIS.
5. В открывшемся диалоге задайте параметры подключения и нажмите кнопку **"Соединить"**:

    - имя Веб-ГИС, например demo.nextgis.com;
    - установите флажок "гость", если хотите подключиться к Веб-ГИС без логина и пароля. Примечание: в этом случае сбор данных при помощи формы может стать недоступным - всё зависит от настроек прав NextGIS Web для гостевой учётной записи;
    - логин;
    - пароль.

6. В появившемся списке групп ресурсов выберите группу ресурсов и нажмите кнопку **"Выбрать"**. В открывшемся после этого диалоге (см. :numref:`ngfb_webgis_prop`) проверьте название нового слоя и тип геометрии и измените их при необходимости. 

 .. figure:: _static/ngfb_webgis_prop_ru.png
   :name: ngfb_webgis_prop
   :align: center
   :width: 13cm
   
   Диалоговое окно "Свойства формы"

Также в этом окне вы можете выбрать, какой комплект ресурсов создать в Веб-ГИС. 
По умолчанию в Веб-ГИС будет создан **новый слой** со структурой полей, определённой в проекте, а к нему загружена созданная **форма**, о чём будет сказано в появившемся сообщении. Этот слой можно добавить в качестве элемента в существующий проект Collector.
В дополнение к этому, можно также создать:
    - Проект Collector (будет создан сам **проект сбора данных** и **подложка веб-карты**)
    - **Веб-карту**
Для этого нужно отметить флажками соответствующие пункты в диалоговом окне.

Нажмите кнопку **"Отправить"**. 

Если создать ресурс не удалось (нет подключения к сети интернет, имя слоя не уникально и т.д.) - об этом также будет выведено сообщение.

Если название слоя оказалось неуникальным, поменять его можно в меню: Правка -> Свойства формы -> Название (по умолчанию «Слой»), а также в процессе отправки в ВебГИС.

.. note::
    Для сбора данных на мобильном устройстве следуйте инструкции NextGIS Mobile и NextGIS Collector. Собираемые при помощи формы данные будут синхронизироваться со слоем автоматически.


Создание формы в NextGIS Web из существующего слоя
--------------------------------------------------

1. Запустите программу. Выберите: Правка -> Скачать из NextGIS;
2. В открывшемся диалоге задайте параметры подключения и нажмите кнопку **"Соединить"**:

    - имя Веб-ГИС, например demo.nextgis.com;
    - установите флажок "гость", если хотите подключиться к Веб-ГИС без логина и пароля. Примечание: в этом случае могут быть показаны не все доступные ресурсы - всё зависит от настроек прав NextGIS Web для гостевой учётной записи;
    - логин;
    - пароль.

3. В появившемся списке ресурсов выберите ресурс с типом "Vector layer" и нажмите кнопку **"Выбрать"**. При успешном соединении будет загружена структура данных слоя, а так же (при наличии) имеющаяся форма;
4. Внесите изменения в форму. Если изначально формы нет, но есть необходимость создать её для уже имеющейся структуры полей - выключите режим автоматического создания полей при создании элементов. Кнопка "Связывать элементы с полями" должна быть *отжата*. Разместите элементы на форме. После этого свяжите поля с этими элементами через свойство "Поле слоя" в меню "Свойства" для каждого элемента. В итоге в меню "Данные" все поля должны иметь зелёные маркеры сигнализирующие о том что поля успешно связаны с элементами, а на самих элементах не должно остаться красных маркеров с восклицательным знаком.
5. Отправьте изменённую форму в NextGIS Web (см. раздел "Создание новой формы в NextGIS Web). Обратите внимание что изменить таким образом существующие ресурсы нельзя, в любом случае будет создан новый слой и к нему загружена форма. Если у слоя, который вы выбрали в начале были данные, то эти данные будут скопированы в новый слой по совпадению полей.
